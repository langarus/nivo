"use strict";var e=require("react"),n=require("lodash/uniq"),o=require("@nivo/core"),t=require("@nivo/legends"),r=require("d3-sankey"),i=require("@nivo/tooltip"),a=require("react/jsx-runtime"),l=require("lodash/cloneDeep"),d=require("@nivo/colors"),s=require("@react-spring/web"),c=require("d3-shape");function u(){return u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(e[t]=o[t])}return e},u.apply(this,arguments)}var h={container:{display:"flex",alignItems:"center"},sourceChip:{marginRight:7},targetChip:{marginLeft:7,marginRight:7}},p={center:r.sankeyCenter,justify:r.sankeyJustify,start:r.sankeyLeft,end:r.sankeyRight},v=Object.keys(p),g=function(e){return p[e]},y={layout:"horizontal",align:"center",sort:"auto",colors:{scheme:"nivo"},nodeOpacity:.75,nodeHoverOpacity:1,nodeHoverOthersOpacity:.15,nodeThickness:12,nodeSpacing:12,nodeInnerPadding:0,nodeBorderWidth:1,nodeBorderColor:{from:"color",modifiers:[["darker",.5]]},nodeBorderRadius:0,linkOpacity:.25,linkHoverOpacity:.6,linkHoverOthersOpacity:.15,linkContract:0,linkBlendMode:"multiply",enableLinkGradient:!1,enableLabels:!0,label:"id",labelPosition:"inside",labelPadding:9,labelOrientation:"horizontal",labelTextColor:{from:"color",modifiers:[["darker",.8]]},isInteractive:!0,nodeTooltip:function(e){var n=e.node;return a.jsx(i.BasicTooltip,{id:n.label,enableChip:!0,color:n.color})},linkTooltip:function(e){var n=e.link;return a.jsx(i.BasicTooltip,{id:a.jsxs("span",{style:h.container,children:[a.jsx(i.Chip,{color:n.source.color,style:h.sourceChip}),a.jsx("strong",{children:n.source.label})," > ",a.jsx("strong",{children:n.target.label}),a.jsx(i.Chip,{color:n.target.color,style:h.targetChip}),a.jsx("strong",{children:n.formattedValue})]})})},legends:[],layers:["links","nodes","labels","legends"],role:"img",animate:!0,motionConfig:"gentle"},f=function(e){return e.id},k=function(n){var t=n.data,i=n.valueFormat,a=n.layout,s=n.width,c=n.height,u=n.sort,h=n.align,p=n.colors,v=n.nodeThickness,y=n.nodeSpacing,k=n.nodeInnerPadding,x=n.nodeBorderColor,m=n.label,C=n.labelTextColor,b=e.useState(null),O=b[0],L=b[1],M=e.useState(null),j=M[0],T=M[1],B=e.useMemo((function(){if("auto"!==u)return"input"===u?null:"ascending"===u?function(e,n){return e.value-n.value}:"descending"===u?function(e,n){return n.value-e.value}:u}),[u]),I="input"===u?null:void 0,w=e.useMemo((function(){return"function"==typeof h?h:g(h)}),[h]),P=o.useTheme(),H=d.useOrdinalColorScale(p,"id"),S=d.useInheritedColor(x,P),N=o.usePropertyAccessor(m),W=d.useInheritedColor(C,P),F=o.useValueFormatter(i),E=e.useMemo((function(){return function(e){var n=e.data,o=e.formatValue,t=e.layout,i=e.alignFunction,a=e.sortFunction,d=e.linkSortMode,s=e.nodeThickness,c=e.nodeSpacing,u=e.nodeInnerPadding,h=e.width,p=e.height,v=e.getColor,g=e.getLabel,y=r.sankey().nodeAlign(i).nodeSort(a).linkSort(d).nodeWidth(s).nodePadding(c).size("horizontal"===t?[h,p]:[p,h]).nodeId(f),k=l(n);return y(k),k.nodes.forEach((function(e){if(e.color=v(e),e.label=g(e),e.formattedValue=o(e.value),"horizontal"===t)e.x=e.x0+u,e.y=e.y0,e.width=Math.max(e.x1-e.x0-2*u,0),e.height=Math.max(e.y1-e.y0,0);else{e.x=e.y0,e.y=e.x0+u,e.width=Math.max(e.y1-e.y0,0),e.height=Math.max(e.x1-e.x0-2*u,0);var n=e.x0,r=e.x1;e.x0=e.y0,e.x1=e.y1,e.y0=n,e.y1=r}})),k.links.forEach((function(e){e.formattedValue=o(e.value),e.color=e.source.color,e.pos0=e.y0,e.pos1=e.y1,e.thickness=e.width,delete e.y0,delete e.y1,delete e.width})),k}({data:t,formatValue:F,layout:a,alignFunction:w,sortFunction:B,linkSortMode:I,nodeThickness:v,nodeSpacing:y,nodeInnerPadding:k,width:s,height:c,getColor:H,getLabel:N})}),[t,F,a,w,B,I,v,y,k,s,c,H,N]),R=E.nodes,q=E.links,A=e.useMemo((function(){return R.map((function(e){return{id:e.id,label:e.label,color:e.color}}))}),[R]);return{nodes:R,links:q,legendData:A,getNodeBorderColor:S,currentNode:O,setCurrentNode:L,currentLink:j,setCurrentLink:T,getLabelTextColor:W}},x=function(n){var t=n.node,r=n.x,l=n.y,d=n.width,c=n.height,u=n.color,h=n.opacity,p=n.borderWidth,v=n.borderColor,g=n.borderRadius,y=n.setCurrent,f=n.isInteractive,k=n.onClick,x=n.tooltip,m=o.useMotionConfig(),C=m.animate,b=m.config,O=s.useSpring({x:r,y:l,width:d,height:c,opacity:h,color:u,config:b,immediate:!C}),L=i.useTooltip(),M=L.showTooltipFromEvent,j=L.hideTooltip,T=e.useCallback((function(n){y(t),M(e.createElement(x,{node:t}),n,"left")}),[y,t,M,x]),B=e.useCallback((function(n){M(e.createElement(x,{node:t}),n,"left")}),[M,t,x]),I=e.useCallback((function(){y(null),j()}),[y,j]),w=e.useCallback((function(e){null==k||k(t,e)}),[k,t]);return a.jsx(s.animated.rect,{x:O.x,y:O.y,rx:g,ry:g,width:O.width.to((function(e){return Math.max(e,0)})),height:O.height.to((function(e){return Math.max(e,0)})),fill:O.color,fillOpacity:O.opacity,strokeWidth:p,stroke:v,strokeOpacity:h,onMouseEnter:f?T:void 0,onMouseMove:f?B:void 0,onMouseLeave:f?I:void 0,onClick:f?w:void 0})},m=function(e){var n=e.nodes,o=e.nodeOpacity,t=e.nodeHoverOpacity,r=e.nodeHoverOthersOpacity,i=e.borderWidth,l=e.getBorderColor,d=e.borderRadius,s=e.setCurrentNode,c=e.currentNode,u=e.currentLink,h=e.isCurrentNode,p=e.isInteractive,v=e.onClick,g=e.tooltip,y=function(e){return c||u?h(e)?t:r:o};return a.jsx(a.Fragment,{children:n.map((function(e){return a.jsx(x,{node:e,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color,opacity:y(e),borderWidth:i,borderColor:l(e),borderRadius:d,setCurrent:s,isInteractive:p,onClick:v,tooltip:g},e.id)}))})},C=function(e){var n,o=e.id,t=e.layout,r=e.startColor,i=e.endColor;return n="horizontal"===t?{x1:"0%",x2:"100%",y1:"0%",y2:"0%"}:{x1:"0%",x2:"0%",y1:"0%",y2:"100%"},a.jsxs("linearGradient",u({id:o,spreadMethod:"pad"},n,{children:[a.jsx("stop",{offset:"0%",stopColor:r}),a.jsx("stop",{offset:"100%",stopColor:i})]}))},b=function(n){var t=n.link,r=n.layout,l=n.path,d=n.color,c=n.opacity,u=n.blendMode,h=n.enableGradient,p=n.setCurrent,v=n.tooltip,g=n.isInteractive,y=n.onClick,f=t.source.id+"."+t.target.id+"."+t.index,k=o.useMotionConfig(),x=k.animate,m=k.config,b=o.useAnimatedPath(l),O=s.useSpring({color:d,opacity:c,config:m,immediate:!x}),L=i.useTooltip(),M=L.showTooltipFromEvent,j=L.hideTooltip,T=e.useCallback((function(n){p(t),M(e.createElement(v,{link:t}),n,"left")}),[p,t,M,v]),B=e.useCallback((function(n){M(e.createElement(v,{link:t}),n,"left")}),[M,t,v]),I=e.useCallback((function(){p(null),j()}),[p,j]),w=e.useCallback((function(e){null==y||y(t,e)}),[y,t]);return a.jsxs(a.Fragment,{children:[h&&a.jsx(C,{id:f,layout:r,startColor:t.startColor||t.source.color,endColor:t.endColor||t.target.color}),a.jsx(s.animated.path,{fill:h?'url("#'+encodeURI(f)+'")':O.color,d:b,fillOpacity:O.opacity,onMouseEnter:g?T:void 0,onMouseMove:g?B:void 0,onMouseLeave:g?I:void 0,onClick:g?w:void 0,style:{mixBlendMode:u}})]})},O=function(n){var o=n.links,t=n.layout,r=n.linkOpacity,i=n.linkHoverOpacity,l=n.linkHoverOthersOpacity,d=n.linkContract,s=n.linkBlendMode,u=n.enableLinkGradient,h=n.setCurrentLink,p=n.currentLink,v=n.currentNode,g=n.isCurrentLink,y=n.isInteractive,f=n.onClick,k=n.tooltip,x=function(e){return v||p?g(e)?i:l:r},m=e.useMemo((function(){return"horizontal"===t?(e=c.line().curve(c.curveMonotoneX),function(n,o){var t=Math.max(1,n.thickness-2*o)/2,r=.12*(n.target.x0-n.source.x1),i=[[n.source.x1,n.pos0-t],[n.source.x1+r,n.pos0-t],[n.target.x0-r,n.pos1-t],[n.target.x0,n.pos1-t],[n.target.x0,n.pos1+t],[n.target.x0-r,n.pos1+t],[n.source.x1+r,n.pos0+t],[n.source.x1,n.pos0+t],[n.source.x1,n.pos0-t]];return e(i)+"Z"}):function(){var e=c.line().curve(c.curveMonotoneY);return function(n,o){var t=Math.max(1,n.thickness-2*o)/2,r=.12*(n.target.y0-n.source.y1),i=[[n.pos0+t,n.source.y1],[n.pos0+t,n.source.y1+r],[n.pos1+t,n.target.y0-r],[n.pos1+t,n.target.y0],[n.pos1-t,n.target.y0],[n.pos1-t,n.target.y0-r],[n.pos0-t,n.source.y1+r],[n.pos0-t,n.source.y1],[n.pos0+t,n.source.y1]];return e(i)+"Z"}}();var e}),[t]);return a.jsx(a.Fragment,{children:o.map((function(e){return a.jsx(b,{link:e,layout:t,path:m(e,d),color:e.color,opacity:x(e),blendMode:s,enableGradient:u,setCurrent:h,isInteractive:y,onClick:f,tooltip:k},e.source.id+"."+e.target.id+"."+e.index)}))})},L=function(e){var n=e.nodes,t=e.layout,r=e.width,i=e.height,l=e.labelPosition,d=e.labelPadding,c=e.labelOrientation,h=e.getLabelTextColor,p=o.useTheme(),v="vertical"===c?-90:0,g=n.map((function(e){var n,o,a;return"horizontal"===t?(o=e.y+e.height/2,e.x<r/2?"inside"===l?(n=e.x1+d,a="vertical"===c?"middle":"start"):(n=e.x-d,a="vertical"===c?"middle":"end"):"inside"===l?(n=e.x-d,a="vertical"===c?"middle":"end"):(n=e.x1+d,a="vertical"===c?"middle":"start")):"vertical"===t&&(n=e.x+e.width/2,e.y<i/2?"inside"===l?(o=e.y1+d,a="vertical"===c?"end":"middle"):(o=e.y-d,a="vertical"===c?"start":"middle"):"inside"===l?(o=e.y-d,a="vertical"===c?"start":"middle"):(o=e.y1+d,a="vertical"===c?"end":"middle")),{id:e.id,label:e.label,x:n,y:o,textAnchor:a,color:h(e)}})),y=o.useMotionConfig(),f=y.animate,k=y.config,x=s.useSprings(g.length,g.map((function(e){return{transform:"translate("+e.x+", "+e.y+") rotate("+v+")",color:e.color,config:k,immediate:!f}})));return a.jsx(a.Fragment,{children:x.map((function(e,n){var o=g[n];return a.jsx(s.animated.text,{dominantBaseline:"central",textAnchor:o.textAnchor,transform:e.transform,style:u({},p.labels.text,{fill:e.color,pointerEvents:"none"}),children:o.label},o.id)}))})},M=["isInteractive","animate","motionConfig","theme","renderWrapper"],j=function(r){var i=r.data,l=r.valueFormat,d=r.layout,s=void 0===d?y.layout:d,c=r.sort,h=void 0===c?y.sort:c,p=r.align,v=void 0===p?y.align:p,g=r.width,f=r.height,x=r.margin,C=r.colors,b=void 0===C?y.colors:C,M=r.nodeThickness,j=void 0===M?y.nodeThickness:M,T=r.nodeSpacing,B=void 0===T?y.nodeThickness:T,I=r.nodeInnerPadding,w=void 0===I?y.nodeInnerPadding:I,P=r.nodeBorderColor,H=void 0===P?y.nodeBorderColor:P,S=r.nodeOpacity,N=void 0===S?y.nodeOpacity:S,W=r.nodeHoverOpacity,F=void 0===W?y.nodeHoverOpacity:W,E=r.nodeHoverOthersOpacity,R=void 0===E?y.nodeHoverOthersOpacity:E,q=r.nodeBorderWidth,A=void 0===q?y.nodeBorderWidth:q,z=r.nodeBorderRadius,G=void 0===z?y.nodeBorderRadius:z,D=r.linkOpacity,V=void 0===D?y.linkOpacity:D,Z=r.linkHoverOpacity,J=void 0===Z?y.linkHoverOpacity:Z,K=r.linkHoverOthersOpacity,U=void 0===K?y.linkHoverOthersOpacity:K,X=r.linkContract,Y=void 0===X?y.linkContract:X,Q=r.linkBlendMode,$=void 0===Q?y.linkBlendMode:Q,_=r.enableLinkGradient,ee=void 0===_?y.enableLinkGradient:_,ne=r.enableLabels,oe=void 0===ne?y.enableLabels:ne,te=r.labelPosition,re=void 0===te?y.labelPosition:te,ie=r.labelPadding,ae=void 0===ie?y.labelPadding:ie,le=r.labelOrientation,de=void 0===le?y.labelOrientation:le,se=r.label,ce=void 0===se?y.label:se,ue=r.labelTextColor,he=void 0===ue?y.labelTextColor:ue,pe=r.nodeTooltip,ve=void 0===pe?y.nodeTooltip:pe,ge=r.linkTooltip,ye=void 0===ge?y.linkTooltip:ge,fe=r.isInteractive,ke=void 0===fe?y.isInteractive:fe,xe=r.onClick,me=r.legends,Ce=void 0===me?y.legends:me,be=r.layers,Oe=void 0===be?y.layers:be,Le=r.role,Me=void 0===Le?y.role:Le,je=r.ariaLabel,Te=r.ariaLabelledBy,Be=r.ariaDescribedBy,Ie=o.useDimensions(g,f,x),we=Ie.margin,Pe=Ie.innerWidth,He=Ie.innerHeight,Se=Ie.outerWidth,Ne=Ie.outerHeight,We=k({data:i,valueFormat:l,layout:s,width:Pe,height:He,sort:h,align:v,colors:b,nodeThickness:j,nodeSpacing:B,nodeInnerPadding:w,nodeBorderColor:H,label:ce,labelTextColor:he}),Fe=We.nodes,Ee=We.links,Re=We.legendData,qe=We.getNodeBorderColor,Ae=We.currentNode,ze=We.setCurrentNode,Ge=We.currentLink,De=We.setCurrentLink,Ve=We.getLabelTextColor,Ze=e.useMemo((function(){var e=function(){return!1},o=function(){return!1};if(Ge&&(e=function(e){var n=e.id;return n===Ge.source.id||n===Ge.target.id},o=function(e){var n=e.source,o=e.target;return n.id===Ge.source.id&&o.id===Ge.target.id}),Ae){var t=[Ae.id];Ee.filter((function(e){var n=e.source,o=e.target;return n.id===Ae.id||o.id===Ae.id})).forEach((function(e){var n=e.source,o=e.target;t.push(n.id),t.push(o.id)})),t=n(t),e=function(e){var n=e.id;return t.includes(n)},o=function(e){var n=e.source,o=e.target;return n.id===Ae.id||o.id===Ae.id}}return{isCurrentNode:e,isCurrentLink:o}}),[Ge,Ae,Ee]),Je=Ze.isCurrentNode,Ke=Ze.isCurrentLink,Ue=e.useMemo((function(){return{links:Ee,nodes:Fe,margin:we,width:g,height:f,outerWidth:Se,outerHeight:Ne,currentNode:Ae,isCurrentNode:Je,setCurrentNode:ze,currentLink:Ge,isCurrentLink:Ke,setCurrentLink:De,isInteractive:ke}}),[Ee,Fe,we,g,f,Se,Ne,Ae,Je,ze,Ge,Ke,De,ke]),Xe={links:null,nodes:null,labels:null,legends:null};return Oe.includes("links")&&(Xe.links=a.jsx(O,{links:Ee,layout:s,linkContract:Y,linkOpacity:V,linkHoverOpacity:J,linkHoverOthersOpacity:U,linkBlendMode:$,enableLinkGradient:ee,setCurrentLink:De,currentNode:Ae,currentLink:Ge,isCurrentLink:Ke,isInteractive:ke,onClick:xe,tooltip:ye},"links")),Oe.includes("nodes")&&(Xe.nodes=a.jsx(m,{nodes:Fe,nodeOpacity:N,nodeHoverOpacity:F,nodeHoverOthersOpacity:R,borderWidth:A,borderRadius:G,getBorderColor:qe,setCurrentNode:ze,currentNode:Ae,currentLink:Ge,isCurrentNode:Je,isInteractive:ke,onClick:xe,tooltip:ve},"nodes")),Oe.includes("labels")&&oe&&(Xe.labels=a.jsx(L,{nodes:Fe,layout:s,width:Pe,height:He,labelPosition:re,labelPadding:ae,labelOrientation:de,getLabelTextColor:Ve},"labels")),Oe.includes("legends")&&(Xe.legends=a.jsx(e.Fragment,{children:Ce.map((function(e,n){return a.jsx(t.BoxLegendSvg,u({},e,{containerWidth:Pe,containerHeight:He,data:Re}),"legend"+n)}))},"legends")),a.jsx(o.SvgWrapper,{width:Se,height:Ne,margin:we,role:Me,ariaLabel:je,ariaLabelledBy:Te,ariaDescribedBy:Be,children:Oe.map((function(n,o){var t;return"function"==typeof n?a.jsx(e.Fragment,{children:e.createElement(n,Ue)},o):null!=(t=null==Xe?void 0:Xe[n])?t:null}))})},T=function(e){var n=e.isInteractive,t=void 0===n?y.isInteractive:n,r=e.animate,i=void 0===r?y.animate:r,l=e.motionConfig,d=void 0===l?y.motionConfig:l,s=e.theme,c=e.renderWrapper,h=function(e,n){if(null==e)return{};var o,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)o=i[t],n.indexOf(o)>=0||(r[o]=e[o]);return r}(e,M);return a.jsx(o.Container,{animate:i,isInteractive:t,motionConfig:d,renderWrapper:c,theme:s,children:a.jsx(j,u({isInteractive:t},h))})};exports.ResponsiveSankey=function(e){return a.jsx(o.ResponsiveWrapper,{children:function(n){var o=n.width,t=n.height;return a.jsx(T,u({width:o,height:t},e))}})},exports.Sankey=T,exports.sankeyAlignmentFromProp=g,exports.sankeyAlignmentPropKeys=v,exports.sankeyAlignmentPropMapping=p,exports.svgDefaultProps=y;
//# sourceMappingURL=nivo-sankey.cjs.js.map
