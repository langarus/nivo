import{useState as e,useMemo as o,useCallback as n,createElement as t,Fragment as i}from"react";import r from"lodash/uniq";import{useTheme as l,usePropertyAccessor as a,useValueFormatter as d,useMotionConfig as c,useAnimatedPath as s,Container as u,useDimensions as h,SvgWrapper as v,ResponsiveWrapper as p}from"@nivo/core";import{BoxLegendSvg as g}from"@nivo/legends";import{sankeyCenter as f,sankeyJustify as y,sankeyLeft as k,sankeyRight as m,sankey as b}from"d3-sankey";import{BasicTooltip as C,Chip as x,useTooltip as O}from"@nivo/tooltip";import{jsx as L,jsxs as I,Fragment as M}from"react/jsx-runtime";import T from"lodash/cloneDeep";import{useOrdinalColorScale as w,useInheritedColor as B}from"@nivo/colors";import{useSpring as H,animated as N,useSprings as P}from"@react-spring/web";import{line as W,curveMonotoneX as F,curveMonotoneY as R}from"d3-shape";function S(){return S=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},S.apply(this,arguments)}var z={container:{display:"flex",alignItems:"center"},sourceChip:{marginRight:7},targetChip:{marginLeft:7,marginRight:7}},E={center:f,justify:y,start:k,end:m},G=Object.keys(E),j=function(e){return E[e]},D={layout:"horizontal",align:"center",sort:"auto",colors:{scheme:"nivo"},nodeOpacity:.75,nodeHoverOpacity:1,nodeHoverOthersOpacity:.15,nodeThickness:12,nodeSpacing:12,nodeInnerPadding:0,nodeBorderWidth:1,nodeBorderColor:{from:"color",modifiers:[["darker",.5]]},nodeBorderRadius:0,linkOpacity:.25,linkHoverOpacity:.6,linkHoverOthersOpacity:.15,linkContract:0,linkBlendMode:"multiply",enableLinkGradient:!1,enableLabels:!0,label:"id",labelPosition:"inside",labelPadding:9,labelOrientation:"horizontal",labelTextColor:{from:"color",modifiers:[["darker",.8]]},isInteractive:!0,nodeTooltip:function(e){var o=e.node;return L(C,{id:o.label,enableChip:!0,color:o.color})},linkTooltip:function(e){var o=e.link;return L(C,{id:I("span",{style:z.container,children:[L(x,{color:o.source.color,style:z.sourceChip}),L("strong",{children:o.source.label})," > ",L("strong",{children:o.target.label}),L(x,{color:o.target.color,style:z.targetChip}),L("strong",{children:o.formattedValue})]})})},legends:[],layers:["links","nodes","labels","legends"],role:"img",animate:!0,motionConfig:"gentle"},V=function(e){return e.id},A=function(n){var t=n.data,i=n.valueFormat,r=n.layout,c=n.width,s=n.height,u=n.sort,h=n.align,v=n.colors,p=n.nodeThickness,g=n.nodeSpacing,f=n.nodeInnerPadding,y=n.nodeBorderColor,k=n.label,m=n.labelTextColor,C=e(null),x=C[0],O=C[1],L=e(null),I=L[0],M=L[1],H=o((function(){if("auto"!==u)return"input"===u?null:"ascending"===u?function(e,o){return e.value-o.value}:"descending"===u?function(e,o){return o.value-e.value}:u}),[u]),N="input"===u?null:void 0,P=o((function(){return"function"==typeof h?h:j(h)}),[h]),W=l(),F=w(v,"id"),R=B(y,W),S=a(k),z=B(m,W),E=d(i),G=o((function(){return function(e){var o=e.data,n=e.formatValue,t=e.layout,i=e.alignFunction,r=e.sortFunction,l=e.linkSortMode,a=e.nodeThickness,d=e.nodeSpacing,c=e.nodeInnerPadding,s=e.width,u=e.height,h=e.getColor,v=e.getLabel,p=b().nodeAlign(i).nodeSort(r).linkSort(l).nodeWidth(a).nodePadding(d).size("horizontal"===t?[s,u]:[u,s]).nodeId(V),g=T(o);return p(g),g.nodes.forEach((function(e){if(e.color=h(e),e.label=v(e),e.formattedValue=n(e.value),"horizontal"===t)e.x=e.x0+c,e.y=e.y0,e.width=Math.max(e.x1-e.x0-2*c,0),e.height=Math.max(e.y1-e.y0,0);else{e.x=e.y0,e.y=e.x0+c,e.width=Math.max(e.y1-e.y0,0),e.height=Math.max(e.x1-e.x0-2*c,0);var o=e.x0,i=e.x1;e.x0=e.y0,e.x1=e.y1,e.y0=o,e.y1=i}})),g.links.forEach((function(e){e.formattedValue=n(e.value),e.color=e.source.color,e.pos0=e.y0,e.pos1=e.y1,e.thickness=e.width,delete e.y0,delete e.y1,delete e.width})),g}({data:t,formatValue:E,layout:r,alignFunction:P,sortFunction:H,linkSortMode:N,nodeThickness:p,nodeSpacing:g,nodeInnerPadding:f,width:c,height:s,getColor:F,getLabel:S})}),[t,E,r,P,H,N,p,g,f,c,s,F,S]),D=G.nodes,A=G.links,Z=o((function(){return D.map((function(e){return{id:e.id,label:e.label,color:e.color}}))}),[D]);return{nodes:D,links:A,legendData:Z,getNodeBorderColor:R,currentNode:x,setCurrentNode:O,currentLink:I,setCurrentLink:M,getLabelTextColor:z}},Z=function(e){var o=e.node,i=e.x,r=e.y,l=e.width,a=e.height,d=e.color,s=e.opacity,u=e.borderWidth,h=e.borderColor,v=e.borderRadius,p=e.setCurrent,g=e.isInteractive,f=e.onClick,y=e.tooltip,k=c(),m=k.animate,b=k.config,C=H({x:i,y:r,width:l,height:a,opacity:s,color:d,config:b,immediate:!m}),x=O(),I=x.showTooltipFromEvent,M=x.hideTooltip,T=n((function(e){p(o),I(t(y,{node:o}),e,"left")}),[p,o,I,y]),w=n((function(e){I(t(y,{node:o}),e,"left")}),[I,o,y]),B=n((function(){p(null),M()}),[p,M]),P=n((function(e){null==f||f(o,e)}),[f,o]);return L(N.rect,{x:C.x,y:C.y,rx:v,ry:v,width:C.width.to((function(e){return Math.max(e,0)})),height:C.height.to((function(e){return Math.max(e,0)})),fill:C.color,fillOpacity:C.opacity,strokeWidth:u,stroke:h,strokeOpacity:s,onMouseEnter:g?T:void 0,onMouseMove:g?w:void 0,onMouseLeave:g?B:void 0,onClick:g?P:void 0})},q=function(e){var o=e.nodes,n=e.nodeOpacity,t=e.nodeHoverOpacity,i=e.nodeHoverOthersOpacity,r=e.borderWidth,l=e.getBorderColor,a=e.borderRadius,d=e.setCurrentNode,c=e.currentNode,s=e.currentLink,u=e.isCurrentNode,h=e.isInteractive,v=e.onClick,p=e.tooltip,g=function(e){return c||s?u(e)?t:i:n};return L(M,{children:o.map((function(e){return L(Z,{node:e,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color,opacity:g(e),borderWidth:r,borderColor:l(e),borderRadius:a,setCurrent:d,isInteractive:h,onClick:v,tooltip:p},e.id)}))})},U=function(e){var o=e.id,n=e.layout,t=e.startColor,i=e.endColor;return I("linearGradient",S({id:o,spreadMethod:"pad"},"horizontal"===n?{x1:"0%",x2:"100%",y1:"0%",y2:"0%"}:{x1:"0%",x2:"0%",y1:"0%",y2:"100%"},{children:[L("stop",{offset:"0%",stopColor:t}),L("stop",{offset:"100%",stopColor:i})]}))},J=function(e){var o=e.link,i=e.layout,r=e.path,l=e.color,a=e.opacity,d=e.blendMode,u=e.enableGradient,h=e.setCurrent,v=e.tooltip,p=e.isInteractive,g=e.onClick,f=o.source.id+"."+o.target.id+"."+o.index,y=c(),k=y.animate,m=y.config,b=s(r),C=H({color:l,opacity:a,config:m,immediate:!k}),x=O(),T=x.showTooltipFromEvent,w=x.hideTooltip,B=n((function(e){h(o),T(t(v,{link:o}),e,"left")}),[h,o,T,v]),P=n((function(e){T(t(v,{link:o}),e,"left")}),[T,o,v]),W=n((function(){h(null),w()}),[h,w]),F=n((function(e){null==g||g(o,e)}),[g,o]);return I(M,{children:[u&&L(U,{id:f,layout:i,startColor:o.startColor||o.source.color,endColor:o.endColor||o.target.color}),L(N.path,{fill:u?'url("#'+encodeURI(f)+'")':C.color,d:b,fillOpacity:C.opacity,onMouseEnter:p?B:void 0,onMouseMove:p?P:void 0,onMouseLeave:p?W:void 0,onClick:p?F:void 0,style:{mixBlendMode:d}})]})},K=function(e){var n=e.links,t=e.layout,i=e.linkOpacity,r=e.linkHoverOpacity,l=e.linkHoverOthersOpacity,a=e.linkContract,d=e.linkBlendMode,c=e.enableLinkGradient,s=e.setCurrentLink,u=e.currentLink,h=e.currentNode,v=e.isCurrentLink,p=e.isInteractive,g=e.onClick,f=e.tooltip,y=function(e){return h||u?v(e)?r:l:i},k=o((function(){return"horizontal"===t?(e=W().curve(F),function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.x0-o.source.x1),r=[[o.source.x1,o.pos0-t],[o.source.x1+i,o.pos0-t],[o.target.x0-i,o.pos1-t],[o.target.x0,o.pos1-t],[o.target.x0,o.pos1+t],[o.target.x0-i,o.pos1+t],[o.source.x1+i,o.pos0+t],[o.source.x1,o.pos0+t],[o.source.x1,o.pos0-t]];return e(r)+"Z"}):function(){var e=W().curve(R);return function(o,n){var t=Math.max(1,o.thickness-2*n)/2,i=.12*(o.target.y0-o.source.y1),r=[[o.pos0+t,o.source.y1],[o.pos0+t,o.source.y1+i],[o.pos1+t,o.target.y0-i],[o.pos1+t,o.target.y0],[o.pos1-t,o.target.y0],[o.pos1-t,o.target.y0-i],[o.pos0-t,o.source.y1+i],[o.pos0-t,o.source.y1],[o.pos0+t,o.source.y1]];return e(r)+"Z"}}();var e}),[t]);return L(M,{children:n.map((function(e){return L(J,{link:e,layout:t,path:k(e,a),color:e.color,opacity:y(e),blendMode:d,enableGradient:c,setCurrent:s,isInteractive:p,onClick:g,tooltip:f},e.source.id+"."+e.target.id+"."+e.index)}))})},Q=function(e){var o=e.nodes,n=e.layout,t=e.width,i=e.height,r=e.labelPosition,a=e.labelPadding,d=e.labelOrientation,s=e.getLabelTextColor,u=l(),h="vertical"===d?-90:0,v=o.map((function(e){var o,l,c;return"horizontal"===n?(l=e.y+e.height/2,e.x<t/2?"inside"===r?(o=e.x1+a,c="vertical"===d?"middle":"start"):(o=e.x-a,c="vertical"===d?"middle":"end"):"inside"===r?(o=e.x-a,c="vertical"===d?"middle":"end"):(o=e.x1+a,c="vertical"===d?"middle":"start")):"vertical"===n&&(o=e.x+e.width/2,e.y<i/2?"inside"===r?(l=e.y1+a,c="vertical"===d?"end":"middle"):(l=e.y-a,c="vertical"===d?"start":"middle"):"inside"===r?(l=e.y-a,c="vertical"===d?"start":"middle"):(l=e.y1+a,c="vertical"===d?"end":"middle")),{id:e.id,label:e.label,x:o,y:l,textAnchor:c,color:s(e)}})),p=c(),g=p.animate,f=p.config,y=P(v.length,v.map((function(e){return{transform:"translate("+e.x+", "+e.y+") rotate("+h+")",color:e.color,config:f,immediate:!g}})));return L(M,{children:y.map((function(e,o){var n=v[o];return L(N.text,{dominantBaseline:"central",textAnchor:n.textAnchor,transform:e.transform,style:S({},u.labels.text,{fill:e.color,pointerEvents:"none"}),children:n.label},n.id)}))})},X=["isInteractive","animate","motionConfig","theme","renderWrapper"],Y=function(e){var n=e.data,l=e.valueFormat,a=e.layout,d=void 0===a?D.layout:a,c=e.sort,s=void 0===c?D.sort:c,u=e.align,p=void 0===u?D.align:u,f=e.width,y=e.height,k=e.margin,m=e.colors,b=void 0===m?D.colors:m,C=e.nodeThickness,x=void 0===C?D.nodeThickness:C,O=e.nodeSpacing,I=void 0===O?D.nodeThickness:O,M=e.nodeInnerPadding,T=void 0===M?D.nodeInnerPadding:M,w=e.nodeBorderColor,B=void 0===w?D.nodeBorderColor:w,H=e.nodeOpacity,N=void 0===H?D.nodeOpacity:H,P=e.nodeHoverOpacity,W=void 0===P?D.nodeHoverOpacity:P,F=e.nodeHoverOthersOpacity,R=void 0===F?D.nodeHoverOthersOpacity:F,z=e.nodeBorderWidth,E=void 0===z?D.nodeBorderWidth:z,G=e.nodeBorderRadius,j=void 0===G?D.nodeBorderRadius:G,V=e.linkOpacity,Z=void 0===V?D.linkOpacity:V,U=e.linkHoverOpacity,J=void 0===U?D.linkHoverOpacity:U,X=e.linkHoverOthersOpacity,Y=void 0===X?D.linkHoverOthersOpacity:X,$=e.linkContract,_=void 0===$?D.linkContract:$,ee=e.linkBlendMode,oe=void 0===ee?D.linkBlendMode:ee,ne=e.enableLinkGradient,te=void 0===ne?D.enableLinkGradient:ne,ie=e.enableLabels,re=void 0===ie?D.enableLabels:ie,le=e.labelPosition,ae=void 0===le?D.labelPosition:le,de=e.labelPadding,ce=void 0===de?D.labelPadding:de,se=e.labelOrientation,ue=void 0===se?D.labelOrientation:se,he=e.label,ve=void 0===he?D.label:he,pe=e.labelTextColor,ge=void 0===pe?D.labelTextColor:pe,fe=e.nodeTooltip,ye=void 0===fe?D.nodeTooltip:fe,ke=e.linkTooltip,me=void 0===ke?D.linkTooltip:ke,be=e.isInteractive,Ce=void 0===be?D.isInteractive:be,xe=e.onClick,Oe=e.legends,Le=void 0===Oe?D.legends:Oe,Ie=e.layers,Me=void 0===Ie?D.layers:Ie,Te=e.role,we=void 0===Te?D.role:Te,Be=e.ariaLabel,He=e.ariaLabelledBy,Ne=e.ariaDescribedBy,Pe=h(f,y,k),We=Pe.margin,Fe=Pe.innerWidth,Re=Pe.innerHeight,Se=Pe.outerWidth,ze=Pe.outerHeight,Ee=A({data:n,valueFormat:l,layout:d,width:Fe,height:Re,sort:s,align:p,colors:b,nodeThickness:x,nodeSpacing:I,nodeInnerPadding:T,nodeBorderColor:B,label:ve,labelTextColor:ge}),Ge=Ee.nodes,je=Ee.links,De=Ee.legendData,Ve=Ee.getNodeBorderColor,Ae=Ee.currentNode,Ze=Ee.setCurrentNode,qe=Ee.currentLink,Ue=Ee.setCurrentLink,Je=Ee.getLabelTextColor,Ke=o((function(){var e=function(){return!1},o=function(){return!1};if(qe&&(e=function(e){var o=e.id;return o===qe.source.id||o===qe.target.id},o=function(e){var o=e.source,n=e.target;return o.id===qe.source.id&&n.id===qe.target.id}),Ae){var n=[Ae.id];je.filter((function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id})).forEach((function(e){var o=e.source,t=e.target;n.push(o.id),n.push(t.id)})),n=r(n),e=function(e){var o=e.id;return n.includes(o)},o=function(e){var o=e.source,n=e.target;return o.id===Ae.id||n.id===Ae.id}}return{isCurrentNode:e,isCurrentLink:o}}),[qe,Ae,je]),Qe=Ke.isCurrentNode,Xe=Ke.isCurrentLink,Ye=o((function(){return{links:je,nodes:Ge,margin:We,width:f,height:y,outerWidth:Se,outerHeight:ze,currentNode:Ae,isCurrentNode:Qe,setCurrentNode:Ze,currentLink:qe,isCurrentLink:Xe,setCurrentLink:Ue,isInteractive:Ce}}),[je,Ge,We,f,y,Se,ze,Ae,Qe,Ze,qe,Xe,Ue,Ce]),$e={links:null,nodes:null,labels:null,legends:null};return Me.includes("links")&&($e.links=L(K,{links:je,layout:d,linkContract:_,linkOpacity:Z,linkHoverOpacity:J,linkHoverOthersOpacity:Y,linkBlendMode:oe,enableLinkGradient:te,setCurrentLink:Ue,currentNode:Ae,currentLink:qe,isCurrentLink:Xe,isInteractive:Ce,onClick:xe,tooltip:me},"links")),Me.includes("nodes")&&($e.nodes=L(q,{nodes:Ge,nodeOpacity:N,nodeHoverOpacity:W,nodeHoverOthersOpacity:R,borderWidth:E,borderRadius:j,getBorderColor:Ve,setCurrentNode:Ze,currentNode:Ae,currentLink:qe,isCurrentNode:Qe,isInteractive:Ce,onClick:xe,tooltip:ye},"nodes")),Me.includes("labels")&&re&&($e.labels=L(Q,{nodes:Ge,layout:d,width:Fe,height:Re,labelPosition:ae,labelPadding:ce,labelOrientation:ue,getLabelTextColor:Je},"labels")),Me.includes("legends")&&($e.legends=L(i,{children:Le.map((function(e,o){return L(g,S({},e,{containerWidth:Fe,containerHeight:Re,data:De}),"legend"+o)}))},"legends")),L(v,{width:Se,height:ze,margin:We,role:we,ariaLabel:Be,ariaLabelledBy:He,ariaDescribedBy:Ne,children:Me.map((function(e,o){var n;return"function"==typeof e?L(i,{children:t(e,Ye)},o):null!=(n=null==$e?void 0:$e[e])?n:null}))})},$=function(e){var o=e.isInteractive,n=void 0===o?D.isInteractive:o,t=e.animate,i=void 0===t?D.animate:t,r=e.motionConfig,l=void 0===r?D.motionConfig:r,a=e.theme,d=e.renderWrapper,c=function(e,o){if(null==e)return{};var n,t,i={},r=Object.keys(e);for(t=0;t<r.length;t++)n=r[t],o.indexOf(n)>=0||(i[n]=e[n]);return i}(e,X);return L(u,{animate:i,isInteractive:n,motionConfig:l,renderWrapper:d,theme:a,children:L(Y,S({isInteractive:n},c))})},_=function(e){return L(p,{children:function(o){var n=o.width,t=o.height;return L($,S({width:n,height:t},e))}})};export{_ as ResponsiveSankey,$ as Sankey,j as sankeyAlignmentFromProp,G as sankeyAlignmentPropKeys,E as sankeyAlignmentPropMapping,D as svgDefaultProps};
//# sourceMappingURL=nivo-sankey.es.js.map
